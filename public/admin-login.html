<!doctype html><html lang="ar" dir="rtl"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>دخول الإدارة</title><link rel="stylesheet" href="./style.css"></head><body><header class="header">
  <div class="brand"><img class="logo" src="./assets/logo-alasala.png"><div class="title">كليات الأصالة – منصة الاختبارات</div></div>
  <nav class="nav">
    <a class="navlink" href="./home.html">الرئيسية</a>
    <a class="navlink" href="./instructions.html">تعليمات سريعة</a>
    <a class="navlink" href="./login.html">دخول أعضاء هيئة التدريس</a>
    <a class="navlink" href="./contact.html">تواصل مع الإدارة</a>
    <a class="navlink" href="./admin-login.html">الإدارة</a>
  </nav>
</header>
<main class="wrapper"><section class="hero-card">
<h1>لوحة الإدارة</h1>
<div class="form-card">
  <label>اسم المستخدم</label><input id="u" placeholder="Admin">
  <label>كلمة المرور</label><input id="p" type="password">
  <div class="row" style="margin-top:10px"><button class="btn btn-prim" onclick="login()">دخول الإدارة</button></div>
</div>
</section></main><footer class="footer">منصة الاختبارات القصيرة – كليات الأصالة | تطوير: د. محمد الشمراني</footer>
<script>
function login(){
 fetch('/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:u.value.trim(),password:p.value})})
 .then(r=>r.json()).then(d=>{
  if(!d.ok){ alert(d.error==='not approved'?'الحساب غير معتمد':'بيانات غير صحيحة'); return; }
  if(!d.teacher.is_admin){ alert('هذا المدخل خاص بالإدارة فقط'); return; }
  localStorage.setItem('token', d.token); location.href='./dashboard.html';
 }).catch(()=>alert('تعذّر الاتصال بالخادم'));
}
</script>
<script>
async function wakeServer(retries=3){
  for(let i=0;i<retries;i++){
    try{
      const ac = new AbortController();
      const t = setTimeout(()=>ac.abort(), 4000);
      const r = await fetch('/api/health',{signal:ac.signal});
      clearTimeout(t);
      if(r.ok){ return true; }
    }catch(e){}
    await new Promise(res=>setTimeout(res, 1200));
  }
  return false;
}
</script>
</body></html>